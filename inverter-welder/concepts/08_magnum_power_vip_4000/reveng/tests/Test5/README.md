# Test 5: check how output voltage changes with additional PWM signal on pin 9 of SG3525A when no load attached to the welder

Build an external PWM generator using Arduino, just like the one in [this test](https://github.com/wmarkow/sandbox/blob/master/inverter-welder/elements/sg3525/tests/Test5/README.md)

<img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/elements/sg3525/tests/Test5/05_external_pwm_circuit.png" width="40%" >

Connect the collector of the transistor to pin 9 of SG3525A in Magnum Power VIP 4000. \
Attach first scope to the collector of transistor (or to pin 9 of SG3525A); \
Attach second scope directly to the welder's positive ouput clamp. \
Attach multimeter to the welder's positive ouput clamp. \
Magnum Power VIP 4000 is not loaded: no additional load is attached to the output clamps.

The expectations of this test are:
 * to see if the average output positive clamp voltage will drop
 * to see if it possible to have 30V on the output with a highest possible frequency of external PWM signal. This is a good voltage to start experimenting with MIG welding.

Additional remarks to oscillograms:
 * signal at the top half of the view (looks like a shark's finn) is from pin 9 of SG2325
   * time per div is given in the table
   * voltage per div is always 5V
   * max voltage value is around 5V
 * signal at the bottom part of the view is from output positive clamp
   * time per div is given in the table
   * voltage per div is 15V
   * min voltage value is around  0V
   * max voltage value is around 65V

Note that signal on pin 9 is an inverted version of PWM generated by Arduino, thus the duty cycle on pin 9 has a different value.
   
 | External PWM frequency [Hz] | External PWM duty cycle [%] | PWM duty cycle on pin 9 [%] | Output clamp voltage [V]| Oscillogram: pin 11 vs output coil voltage | Time per div | Remark |
 |---|---|---|---|---|---|---|
 | 5873 |  0.000 | 100.000 | 62.0 | <img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test5/1_no_pwm.jpg" width="40%" > | 50us | |
 | 5873 | 50.000 |  50.000 | 54.8 | <img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test5/2_ipwm_5873Hz_50.jpg" width="40%" > | 50us | I tought that I will have here a 30V on output clamp. No. It looks that the output voltage doesn't drop immediatelly.|
 | 5873 | 75.000 |  25.000 | 48.8 | <img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test5/3_ipwm_5873Hz_25.jpg" width="40%" > | 50us | The voltage still doesn't drop immediatelly.|
 | 5873 | 87.500 |  22.500 | 45.8 | <img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test5/4_ipwm_5873Hz_12.5.jpg" width="40%" > | 50us | The voltage slowly drops. The curve suggest that we may have here a capacitor discharging (?) |
 | 2937 | 93.750 |   6.250 | 37.6 | <img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test5/5_ipwm_2937Hz_6.25.jpg" width="40%" > | 0.1ms | Almost there: we have 37.6V on the output clamp.|
 | 1468 | 96.875 |   3.125 | 29.4 | <img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test5/6_ipwm_1468Hz_3.125.jpg" width="40%" > | 0.2ms | Yes! The voltage drops to 20V but average voltage of the signal is about 30V. This is what I want but I'm not happy with the PWM frequency: 1468 Hz|

Conclusions: the voltage doesn't drop immediatelly as I tought. It will be not so easy to lower the output voltage to the 30V. Of course it can be finally done with 1468 Hz PWM signal
witj 3.125% of duty cycle. I'm not quote sure what will happen if I start MIG welding. And the main question: why the voltage drops so slow?

Now I know why the voltage drops so slow. In general when the output is not loaded (on idle), then the energy from the output coil will not be consumed and the voltage doesn't drop.
When the output clamps are loaded with some resistance then the voltage will discharge: the smaller load the faster it will discharge. During welding the load is like a few ohms 
and also occurs a shortcuts to graound when the drop of melted stick electrode drops down to the melting point.
In Magnum Power VIP 400 there is an output voltage sensor which is used to detect a long lasting shortcut (then the output voltage is shutdown). This voltage sensor is done
in the way that there is a resistor divider attached to the output clamp:
see https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/output_trafo.asc  schematic for reference.
Divider consists of of R83 and R84 which togehter have 17.2kOhm. This is an initial load even on idle. Because of this, the voltage doesn't drop "so fast".
My next idea is: test the output voltage when a small load is attached to the output.
See [Test 6: check how output voltage changes with additional PWM signal on pin 9 of SG3525A when small load attached to the welder](https://github.com/wmarkow/sandbox/tree/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test6/README.md)
 







