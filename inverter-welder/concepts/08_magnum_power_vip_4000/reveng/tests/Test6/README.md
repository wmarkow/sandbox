# Test 6: check how output voltage changes with additional PWM signal on pin 9 of SG3525A when small load attached to the welder

Build an external PWM generator using Arduino, just like the one in [Test 5](https://github.com/wmarkow/sandbox/blob/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test5/README.md)

<img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/elements/sg3525/tests/Test5/05_external_pwm_circuit.png" width="40%" >

Connect the collector of the transistor to pin 9 of SG3525A in Magnum Power VIP 4000. \
Attach first scope to the collector of transistor (or to pin 9 of SG3525A); \
Attach second scope directly to the welder's positive ouput clamp. \
Attach multimeter to the welder's positive ouput clamp. \
Magnum Power VIP 4000 is loaded: a 40W 230V bulb is attached to the output clamps. See the photo below:

<img src="https://github.com/wmarkow/sandbox/blob/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test6/test_environment.jpg" width="40%" >

The expectations of this test are:
 * to see if the average output positive clamp voltage will drop faster (in comparison to the not loaded welder)
 * to see if it possible to have 30V on the output with a highest possible frequency of external PWM signal. This is a good voltage to start experimenting with MIG welding.

Additional remarks to oscillograms:
 * signal at the top half of the view (looks like a shark's finn) is from pin 9 of SG2325
   * time per div is 50us
   * voltage per div is always 5V
   * max voltage value is around 5V
 * signal at the bottom part of the view is from output positive clamp
   * time per div 50us
   * voltage per div is 15V
   * min voltage value is around  0V
   * max voltage value is around 65V

Note that signal on pin 9 is an inverted version of PWM generated by Arduino, thus the duty cycle on pin 9 has a different value.
   
 | External PWM frequency [Hz] | External PWM duty cycle [%] | PWM duty cycle on pin 9 [%] | Output clamp voltage [V]| Oscillogram: pin 11 vs output voltage | Remark |
 |---|---|---|---|---|---|
 | 5873 |  0 | 100 | not meassured | <img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test6/1.jpg" width="40%" > | Atention: image just for reference. This was done when the bulb was not connected to the welder. |
 | 5873 | 50 |  50 | not meassured | <img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test6/2.jpg" width="40%" > | Atention: image just for reference. This was done when the bulb was not connected to the welder. The voltage doesn't drop immediatelly.|
 | 5873 |  0 | 100 | not meassured | <img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test6/3.jpg" width="40%" > | The bulb is attached to the output; bulb current is about 90mA. Voltage drops a bit (see those spikes).  |
 | 5873 | 50 |  50 | 140 | <img src="https://raw.githubusercontent.com/wmarkow/sandbox/master/inverter-welder/concepts/08_magnum_power_vip_4000/reveng/tests/Test6/4.jpg" width="40%" > | The bulb is attached to the output; bulb current is about 60mA. Voltage drops faster to 0V. Interesting: multimeter shows 140V. I do not know why. |

Conclusions: the voltage drop immediatelly as I tought. Now there is nothing strange about it as the 40W bulb gives some relative small resistance (62V / 0.090A gives around 689 ohms) 
on the output clamps and the output capacitor is discharged faster.

I'm not quite sure if this kind of additional control (50% PWM at around 5873Hz to pull down pin 9 of SG3525) is good and how will the welding machine behave if I wanted to weld.
The frequency of the output signal (about 90kHz) is disturbed by external PWM signal. Will that work or will it i.e. IGBT transistrs break because of this dusturbance?

Of course a small accident happened after the tests: I wanted to meassure the output voltage with the multimeter by I forgot that multimeter was set to meassure 10A of current 
(so it was an ammeter), so I accidentally did a short cut of the weldeing machine output. Almost immediatelly the orange LED onthe device (the one that indicates overheat or overcurrent) 
was on and the voltage on the output droped to around 10V. I switched off the machine and detached the external PWM signal, started the machine again; the output voltage was 62V and the orange 
LED was off. Multimeter survived, welding machine survived, it seems like nothing bad happened. I think that orange LED was enabled not by an overheating (the radiators were cold)
but rather by the overcurrent in the IGBT transistor section. But why? Is it because of the external PWM signal which disturbs the normal operation? The normal operation is that
IGBT transistors switch the output voltage with about 90kHz frequency, but this frequency must not be disturbed. My external PWM signal disturbs the normal operation.

I did the shortcut twice but I do not remember if the orange LED was on at the second time. The welding machine was "dead" (the output voltage was around 10V) longer that time,
it didn't help even when I restarted it. So I gave up and put it back. After a few days I started the machnine and everything seems to be fine again; the output voltage is 62V again.